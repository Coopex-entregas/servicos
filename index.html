<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>COOPEX ENTREGAS - Pedido</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      padding: 20px;
    }
    .container {
      max-width: 720px;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
    }
    input[type="text"], input[type="tel"], select, button {
      width: 100%;
      padding: 10px;
      margin: 6px 0;
      border-radius: 4px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    label {
      margin-top: 10px;
      margin-bottom: 5px;
      display: block;
    }
    button {
      background-color: #007bff;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #0056b3;
    }
    .bloco-endereco {
      background: #f9f9f9;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 6px;
    }
    .linha.caixinhas {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
    }
    .linha.caixinhas label {
      flex: 1 1 45%;
      white-space: nowrap;
      margin-top: 0;
      margin-bottom: 0;
    }
    #mensagemPix {
      color: green;
      margin-top: 5px;
      margin-bottom: 10px;
      display: none;
    }
    #opcoesDinheiro {
      display: none;
      margin-top: 5px;
      margin-bottom: 10px;
      gap: 15px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>COOPEX ENTREGAS</h1>
    <form id="pedidoForm" onsubmit="return false;">
      <label>Nome do solicitante:</label>
      <input type="text" id="nomeSolicitante" />
      <label>Telefone do solicitante:</label>
      <input type="tel" id="telefoneSolicitante" />

      <h3>Endere√ßo(s) de Coleta</h3>
      <div id="coleta-container"></div>
      <button type="button" onclick="adicionarColeta()">+ Coleta</button>

      <h3>Parada(s)</h3>
      <div id="parada-container"></div>
      <button type="button" onclick="adicionarParada()">+ Parada</button>

      <h3>Endere√ßo(s) de Entrega</h3>
      <div id="entrega-container"></div>
      <button type="button" onclick="adicionarEntrega()">+ Entrega</button>

      <label>Nome de quem receber√°:</label>
      <input type="text" id="nomeRecebedor" />
      <label>Telefone de quem receber√° (opcional):</label>
      <input type="tel" id="telefoneRecebedor" />

      <label>Tipo de servi√ßo:</label>
      <div class="linha caixinhas">
        <label><input type="checkbox" value="Coleta/Entrega" /> Coleta/Entrega</label>
        <label><input type="checkbox" value="Cart√≥rio" /> Cart√≥rio</label>
        <label><input type="checkbox" value="Correios" /> Correios</label>
        <label><input type="checkbox" value="Compras" /> Compras</label>
        <label><input type="checkbox" id="outrosServico" /> Outros</label>
      </div>
      <input type="text" id="outrosDescricao" placeholder="Descreva se marcou 'Outros'" />

      <label>Forma de pagamento:</label>
      <div class="linha caixinhas" id="formasPagamento">
        <label><input type="checkbox" value="Pix" onchange="mostrarOpcoesPagamento()" /> Pix</label>
        <label><input type="checkbox" value="Dinheiro" onchange="mostrarOpcoesPagamento()" /> Dinheiro</label>
        <label><input type="checkbox" value="Contrato" onchange="mostrarOpcoesPagamento()" /> Contrato</label>
      </div>

      <p id="mensagemPix">
        Ap√≥s o envio do comprovante, o pedido ser√° conclu√≠do e encaminharemos o motoboy assim que poss√≠vel.
      </p>

      <div id="opcoesDinheiro" class="linha caixinhas">
        <label><input type="radio" name="receberDinheiro" value="coleta" /> Receber na coleta</label>
        <label><input type="radio" name="receberDinheiro" value="entrega" /> Receber na entrega</label>
      </div>

      <div class="linha caixinhas">
        <label><input type="checkbox" id="temRetorno" /> Tem retorno de entrega</label>
        <label><input type="radio" name="acao" value="Solicitar Motoboy" checked /> Solicitar Motoboy</label>
        <label><input type="radio" name="acao" value="Or√ßamento" /> Apenas Or√ßamento</label>
      </div>

      <button type="button" onclick="enviarParaWhatsApp()">Enviar Pedido via WhatsApp</button>
    </form>
  </div>

  <script>
    let totalColetas = 0;
    let totalParadas = 0;
    let totalEntregas = 0;

    function criarBlocoEndereco(tipo, index) {
      return `
        <div class="bloco-endereco">
          <label>üî¢ CEP (opcional):</label>
          <input type="text" id="cep${tipo}${index}" />
          <button type="button" onclick="buscarEndereco('${tipo}', ${index})">Buscar Endere√ßo</button>
          <label>üõ£Ô∏è Rua:</label>
          <input type="text" id="rua${tipo}${index}" />
          <label>üè† N√∫mero:</label>
          <input type="text" id="numero${tipo}${index}" />
          <label>üìç Bairro:</label>
          <input type="text" id="bairro${tipo}${index}" />
          <label>üèôÔ∏è Cidade:</label>
          <input type="text" id="cidade${tipo}${index}" />
          <label>üìù Complemento:</label>
          <input type="text" id="complemento${tipo}${index}" />
          <label>‚≠ê Ponto de refer√™ncia:</label>
          <input type="text" id="referencia${tipo}${index}" />
        </div>
      `;
    }

    function adicionarColeta() {
      if (totalColetas >= 3) {
        alert("M√°ximo 3 coletas.");
        return;
      }
      totalColetas++;
      document.getElementById("coleta-container").insertAdjacentHTML("beforeend", criarBlocoEndereco("Coleta", totalColetas));
    }

    function adicionarParada() {
      totalParadas++;
      document.getElementById("parada-container").insertAdjacentHTML("beforeend", criarBlocoEndereco("Parada", totalParadas));
    }

    function adicionarEntrega() {
      if (totalEntregas >= 20) {
        alert("M√°ximo 20 entregas.");
        return;
      }
      totalEntregas++;
      document.getElementById("entrega-container").insertAdjacentHTML("beforeend", criarBlocoEndereco("Entrega", totalEntregas));
    }

    function buscarEndereco(tipo, index) {
      const cep = document.getElementById(`cep${tipo}${index}`).value.replace(/\D/g, "");
      if (cep.length !== 8) {
        alert("CEP inv√°lido para busca.");
        return;
      }
      fetch(`https://viacep.com.br/ws/${cep}/json/`)
        .then(resp => resp.json())
        .then(data => {
          if (data.erro) {
            alert("CEP n√£o encontrado.");
            return;
          }
          document.getElementById(`rua${tipo}${index}`).value = data.logradouro || "";
          document.getElementById(`bairro${tipo}${index}`).value = data.bairro || "";
          document.getElementById(`cidade${tipo}${index}`).value = data.localidade || "";
        })
        .catch(() => {
          alert("Erro ao buscar o CEP.");
        });
    }

    function mostrarOpcoesPagamento() {
      const pix = document.querySelector('input[value="Pix"]');
      const dinheiro = document.querySelector('input[value="Dinheiro"]');

      document.getElementById("mensagemPix").style.display = (pix && pix.checked) ? "block" : "none";
      document.getElementById("opcoesDinheiro").style.display = (dinheiro && dinheiro.checked) ? "flex" : "none";
    }

    function enviarParaWhatsApp() {
      let mensagem = "üöÄ *Novo Pedido COOPEX ENTREGAS*\n\n";

      const nomeSolicitante = document.getElementById("nomeSolicitante").value.trim();
      const telSolicitante = document.getElementById("telefoneSolicitante").value.trim();
      if (nomeSolicitante || telSolicitante) {
        mensagem += "üôã *Solicitante:*\n";
        if (nomeSolicitante) mensagem += `üë§ ${nomeSolicitante}\n`;
        if (telSolicitante) mensagem += `üìû ${telSolicitante}\n`;
        mensagem += "\n";
      }

      for (let i = 1; i <= totalColetas; i++) {
        let bloco = "";
        const cep = document.getElementById(`cepColeta${i}`).value.trim();
        const rua = document.getElementById(`ruaColeta${i}`).value.trim();
        const numero = document.getElementById(`numeroColeta${i}`).value.trim();
        const bairro = document.getElementById(`bairroColeta${i}`).value.trim();
        const cidade = document.getElementById(`cidadeColeta${i}`).value.trim();
        const complemento = document.getElementById(`complementoColeta${i}`).value.trim();
        const ref = document.getElementById(`referenciaColeta${i}`).value.trim();

        if (cep || rua || numero || bairro || cidade || complemento || ref) {
          bloco += `üì¶ *Coleta ${i}:*\n`;
          if (cep) bloco += `üî¢ CEP: ${cep}\n`;
          if (rua) bloco += `üõ£Ô∏è Rua: ${rua}\n`;
          if (numero) bloco += `üè† N√∫mero: ${numero}\n`;
          if (bairro) bloco += `üìç Bairro: ${bairro}\n`;
          if (cidade) bloco += `üèôÔ∏è Cidade: ${cidade}\n`;
          if (complemento) bloco += `üìù Complemento: ${complemento}\n`;
          if (ref) bloco += `‚≠ê Refer√™ncia: ${ref}\n`;
          bloco += "\n";
          mensagem += bloco;
        }
      }

      for (let i = 1; i <= totalParadas; i++) {
        let bloco = "";
        const cep = document.getElementById(`cepParada${i}`).value.trim();
        const rua = document.getElementById(`ruaParada${i}`).value.trim();
        const numero = document.getElementById(`numeroParada${i}`).value.trim();
        const bairro = document.getElementById(`bairroParada${i}`).value.trim();
        const cidade = document.getElementById(`cidadeParada${i}`).value.trim();
        const complemento = document.getElementById(`complementoParada${i}`).value.trim();
        const ref = document.getElementById(`referenciaParada${i}`).value.trim();

        if (cep || rua || numero || bairro || cidade || complemento || ref) {
          bloco += `‚è∏Ô∏è *Parada ${i}:*\n`;
          if (cep) bloco += `üî¢ CEP: ${cep}\n`;
          if (rua) bloco += `üõ£Ô∏è Rua: ${rua}\n`;
          if (numero) bloco += `üè† N√∫mero: ${numero}\n`;
          if (bairro) bloco += `üìç Bairro: ${bairro}\n`;
          if (cidade) bloco += `üèôÔ∏è Cidade: ${cidade}\n`;
          if (complemento) bloco += `üìù Complemento: ${complemento}\n`;
          if (ref) bloco += `‚≠ê Refer√™ncia: ${ref}\n`;
          bloco += "\n";
          mensagem += bloco;
        }
      }

      for (let i = 1; i <= totalEntregas; i++) {
        let bloco = "";
        const cep = document.getElementById(`cepEntrega${i}`).value.trim();
        const rua = document.getElementById(`ruaEntrega${i}`).value.trim();
        const numero = document.getElementById(`numeroEntrega${i}`).value.trim();
        const bairro = document.getElementById(`bairroEntrega${i}`).value.trim();
        const cidade = document.getElementById(`cidadeEntrega${i}`).value.trim();
        const complemento = document.getElementById(`complementoEntrega${i}`).value.trim();
        const ref = document.getElementById(`referenciaEntrega${i}`).value.trim();

        if (cep || rua || numero || bairro || cidade || complemento || ref) {
          bloco += `üì¨ *Entrega ${i}:*\n`;
          if (cep) bloco += `üî¢ CEP: ${cep}\n`;
          if (rua) bloco += `üõ£Ô∏è Rua: ${rua}\n`;
          if (numero) bloco += `üè† N√∫mero: ${numero}\n`;
          if (bairro) bloco += `üìç Bairro: ${bairro}\n`;
          if (cidade) bloco += `üèôÔ∏è Cidade: ${cidade}\n`;
          if (complemento) bloco += `üìù Complemento: ${complemento}\n`;
          if (ref) bloco += `‚≠ê Refer√™ncia: ${ref}\n`;
          bloco += "\n";
          mensagem += bloco;
        }
      }

      const nomeRecebedor = document.getElementById("nomeRecebedor").value.trim();
      const telRecebedor = document.getElementById("telefoneRecebedor").value.trim();
      if (nomeRecebedor || telRecebedor) {
        mensagem += "üôç *Recebedor:*\n";
        if (nomeRecebedor) mensagem += `üë§ ${nomeRecebedor}\n`;
        if (telRecebedor) mensagem += `üìû ${telRecebedor}\n`;
        mensagem += "\n";
      }

      let tiposServico = [];
      document.querySelectorAll('input[type="checkbox"]:checked').forEach(cb => {
        if (cb.id === "outrosServico") return;
        if (["Pix", "Dinheiro", "Contrato", "temRetorno"].includes(cb.value)) return;
        tiposServico.push(cb.value);
      });
      if (document.getElementById("outrosServico").checked) {
        const outrosDesc = document.getElementById("outrosDescricao").value.trim();
        if (outrosDesc) tiposServico.push(`Outros: ${outrosDesc}`);
      }
      if (tiposServico.length > 0) {
        mensagem += "üõ†Ô∏è *Tipo de Servi√ßo:*\n";
        tiposServico.forEach(ts => {
          mensagem += `- ${ts}\n`;
        });
        mensagem += "\n";
      }

      let formasPagamento = [];
      document.querySelectorAll('input[type="checkbox"]:checked').forEach(cb => {
        if (["Pix", "Dinheiro", "Contrato"].includes(cb.value)) {
          formasPagamento.push(cb.value);
        }
      });
      if (formasPagamento.length > 0) {
        mensagem += "üí∞ *Forma de Pagamento:*\n";
        formasPagamento.forEach(fp => {
          mensagem += `- ${fp}\n`;
        });
        mensagem += "\n";
      }

      const dinheiroOpcao = document.querySelector('input[name="receberDinheiro"]:checked');
      if (dinheiroOpcao) {
        mensagem += `üíµ *Receber Dinheiro:*\n- ${dinheiroOpcao.value}\n\n`;
      }

      if (document.getElementById("temRetorno").checked) {
        mensagem += "üîÑ *Tem Retorno de Entrega: Sim*\n\n";
      }

      const acao = document.querySelector('input[name="acao"]:checked');
      if (acao) {
        mensagem += `‚ö° *A√ß√£o Desejada:*\n- ${acao.value}\n\n`;
      }

      const numeroWhatsApp = "5584981110706";
      const urlWhatsApp = `https://api.whatsapp.com/send?phone=${numeroWhatsApp}&text=${encodeURIComponent(mensagem)}`;
      window.open(urlWhatsApp, "_blank");
    }
  </script>
</body>
</html>
